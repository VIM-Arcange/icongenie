#!/usr/bin/env node

const parseArgs = require('minimist')

const argv = parseArgs(process.argv.slice(2), {
  alias: {
    m: 'mode',
    h: 'help'
  },
  boolean: ['h']
})

if (argv.help) {
  console.log(`
  Description
    Verifies your Quasar App's icons for all installed modes.

  Usage
    $ icongenie verify

  Options
    --mode, -m     For which Quasar mode to generate icon files
                   (if no mode is specified, it detects what modes
                   are installed and verifies all them)
                      [all|spa|ssr|pwa|cordova|capacitor|electron|bex]
    --help, -h     Displays this message
  `)
  process.exit(0)
}

const fs = require('fs')
const { green, red, underline } = require('chalk')

const { warn } = require('../lib/logger')
const { appDir } = require('../lib/app-paths')
const { modesList, getAllModes, Mode } = require('../lib/modes')

function showMode (mode) {
  console.log(` ${green(underline(`Mode ${mode.name.toUpperCase()}`))} \n`)

  mode.files.forEach(file => {
    console.log(` ${fs.existsSync(file.absoluteName) ? green('OK') : red('missing!')} - ${file.relativeName}`)
  })

  console.log()
}

if (argv.mode && !modesList.includes(argv.mode)) {
  warn(`Invalid mode specified`)
  process.exit(1)
}

const modes = argv.mode
  ? [ new Mode(argv.mode, appDir) ]
  : getAllModes(appDir)

modes.forEach(mode => {
  if (mode.isInstalled) {
    showMode(mode)
  }
})
